

build-pipeline:
  variables:
    AUTO_PIPELINE_ID: 1
  trigger:
    include: "https://raw.githubusercontent.com/Vi3arD/jenkis-test-pipeline/gitlab-pipe-1/qa-build.yml"
    strategy: depend
  except:
    variables:
    - $PIPELINE_ID

destroy-pipeline:
  variables:
    PIPELINE_ID: $PIPELINE_ID
    CC_ENV: $CC_ENV
  trigger:
    include: "https://raw.githubusercontent.com/Vi3arD/jenkis-test-pipeline/gitlab-pipe-1/qa-destroy.yml"
    strategy: depend
  rules:
    - if: '$CI_PIPELINE_SOURCE == "trigger" && $PIPELINE_ID == "3"'
    
# build_vars:
#   stage: build
#   script:
#     - echo "PIPELINE_ID=$PIPELINE_ID CC_USER=Super__Odmen CC_ENV=$CC_ENV" > var.env
#   artifacts:
#     reports:
#       dotenv: var.env    

deploy-pipeline:
  inherit:
    variables: true
  variables:
    PIPELINE_ID: $PIPELINE_ID
    CC_USER: supod
    CC_ENV: $CC_ENV
  trigger:
    include: "https://raw.githubusercontent.com/Vi3arD/jenkis-test-pipeline/gitlab-pipe-1/qa-deploy.yml"
    strategy: depend
  rules:
    - if: '$CI_PIPELINE_SOURCE == "trigger" && $PIPELINE_ID == "2"'

